<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>RMCTR Estimator</title>
<meta name="description" content="Cooling tower inspection estimate generator for field technicians"/>
<meta name="theme-color" content="#0B2A35"/>
<meta name="apple-mobile-web-app-capable" content="yes"/>
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
<link rel="icon" type="image/png" href="logo/rmctr-logo.png"/>
<link rel="apple-touch-icon" href="logo/rmctr-logo.png"/>
<link rel="manifest" href="manifest.json"/>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=DM+Serif+Display&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="css/main.css"/>
<link rel="stylesheet" href="css/dark.css"/>
<link rel="stylesheet" href="css/print.css" media="print"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pako/2.1.0/pako.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>
<body>
<div id="shell">

<nav id="sidebar">
  <div class="sb-logo">
    <img src="logo/rmctr-logo.png" alt="RMCTR" class="sb-logo-img" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'"/><div class="sb-logo-badge" style="display:none">R</div>
    <h1>RMCTR</h1>
    <p>Rocky Mountain Cooling Tower Repair</p>
  </div>
  <div class="sb-nav">
    <div class="sb-nav-label">Menu</div>
    <button class="sb-btn active" id="nav-dashboard">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
      Dashboard
    </button>
    <button class="sb-btn" id="nav-new">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
      New Estimate
    </button>
    <button class="sb-btn" id="nav-editor">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
      Current Estimate
    </button>
    <div class="sb-nav-label" style="margin-top:20px">Data</div>
    <button class="sb-btn" id="nav-customers">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
      Customers
    </button>
    <button class="sb-btn" id="nav-catalog">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/></svg>
      Parts Catalog
    </button>
    <div class="sb-nav-label" style="margin-top:20px">Company</div>
    <button class="sb-btn" id="nav-settings">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/><circle cx="12" cy="12" r="3"/></svg>
      Company Settings
    </button>
    <button class="sb-btn" id="nav-help">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/></svg>
      Help &amp; Info
    </button>
  </div>
  <div class="sb-footer">
    <span>v3.0 &middot; RMCTR</span>
    <button class="dark-toggle" id="dark-toggle" aria-label="Toggle dark mode">
      <svg fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/></svg>
    </button>
  </div>
</nav>

<div id="main">
  <header id="topbar">
    <div style="display:flex;align-items:center;gap:10px">
      <button id="hamburger" aria-label="Menu">
        <svg width="22" height="22" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
      <h2 id="page-title">Dashboard</h2>
    </div>
    <div class="topbar-actions">
      <button class="btn btn-primary" id="btn-new-top">
        <svg width="15" height="15" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2.5" d="M12 4v16m8-8H4"/></svg>
        <span>New Estimate</span>
      </button>
    </div>
  </header>

  <div id="content">

    <!-- ═══ DASHBOARD ═══ -->
    <div id="page-dashboard" class="page active">
      <div class="dash-stats">
        <div class="stat-card"><div class="num" id="stat-total">0</div><div class="label">Total Jobs</div></div>
        <div class="stat-card"><div class="num" id="stat-revenue">$0</div><div class="label">Est. Revenue</div></div>
        <div class="stat-card"><div class="num" id="stat-month">0</div><div class="label">This Month</div></div>
        <div class="stat-card"><div class="num" id="stat-avg">$0</div><div class="label">Avg Value</div></div>
      </div>
      <div id="charts-container"></div>
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;flex-wrap:wrap;gap:10px">
        <h3 style="font-family:var(--font-d);font-size:18px;color:var(--teal)">Recent Estimates</h3>
        <div class="dash-actions">
          <button class="btn btn-sm btn-ghost" id="btn-export-all">&#128190; Export All</button>
          <button class="btn btn-sm btn-ghost" id="btn-import">&#128194; Import</button>
        </div>
      </div>
      <div class="search-bar">
        <svg class="search-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="search-input" placeholder="Search by customer, address, unit..."/>
      </div>
      <div id="jobs-grid" class="jobs-grid"></div>
    </div>

    <!-- ═══ EDITOR ═══ -->
    <div id="page-editor" class="page">
      <div class="editor-toolbar" style="display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap">
        <button class="btn btn-ghost" id="btn-save">&#128190; Save Draft</button>
        <button class="btn btn-secondary" id="btn-preview">&#128065; Preview PDF</button>
        <select id="pdf-theme-select" class="btn btn-ghost btn-sm" style="cursor:pointer">
          <option value="standard">Standard PDF</option>
          <option value="minimal">Minimal</option>
          <option value="executive">Executive Summary</option>
        </select>
        <button class="btn btn-teal" id="btn-email">&#128139; Email</button>
        <button class="btn btn-primary" id="btn-download">&#8659; Download</button>
        <button class="btn btn-ghost" id="btn-print">&#128424; Print</button>
        <button class="btn btn-ghost" id="btn-share">&#128279; Share</button>
        <button class="btn btn-ghost" id="btn-qr">QR</button>
        <button class="btn btn-ghost" id="btn-shopify">&#128722; Shopify</button>
        <button class="btn btn-ghost" id="btn-save-tpl">&#128203; Save as Template</button>
        <button class="btn btn-ghost" id="btn-new-version">&#128260; New Version</button>
      </div>

      <!-- Version Bar -->
      <div id="version-bar" class="version-bar" style="display:none">
        <span class="ver-label">Version 1</span>
        <select id="version-select"></select>
      </div>

      <div class="form-sections">

        <div class="form-section">
          <div class="form-section-header"><h3>Job Information</h3></div>
          <div class="form-section-body">
            <div class="form-grid">
              <div class="form-group" style="position:relative">
                <label>Customer Name</label>
                <input id="f-customer" placeholder="e.g. Ice Ranch" autocomplete="off"/>
                <div id="customer-dropdown" class="autocomplete-dropdown"></div>
              </div>
              <div class="form-group"><label>Site Address</label><input id="f-address" placeholder="841 Southpark Dr."/></div>
              <div class="form-group"><label>Contact Phone</label><input id="f-phone" type="tel" placeholder="303-555-0000"/></div>
              <div class="form-group"><label>Contact Email</label><input id="f-email" type="email" placeholder="contact@client.com"/></div>
              <div class="form-group"><label>Inspection Date</label><input id="f-date" type="date"/></div>
              <div class="form-group"><label>Unit Make / Model</label><input id="f-unit-make" placeholder="Baltimore Aircoil Company"/></div>
              <div class="form-group"><label>Unit ID / Model</label><input id="f-unit-id" placeholder="CXV-134/P"/></div>
              <div class="form-group"><label>Reference / Year</label><input id="f-ref" placeholder="Factory 2001"/></div>
              <div class="form-group"><label>CHWS Enable Temp</label><input id="f-chws" placeholder="52 deg F"/></div>
              <div class="form-group"><label>Ambient Temp</label><input id="f-ambient" placeholder="47 deg F"/></div>
              <div class="form-group"><label>Status</label>
                <select id="f-status"><option value="draft">Draft</option><option value="complete">Complete</option></select>
              </div>
              <div class="form-group"><label>Output Filename</label><input id="f-filename" placeholder="RMCTR_Customer_Estimate.pdf"/></div>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Inspection Findings</h3>
            <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-finding">+ Add</button>
          </div>
          <div class="form-section-body">
            <div class="dyn-list" id="findings-list"></div>
            <button class="add-row-btn" id="btn-add-finding2">+ Add Finding</button>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Performance Data</h3>
            <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-perf">+ Add</button>
          </div>
          <div class="form-section-body">
            <div class="dyn-list" id="perf-list"></div>
            <div class="form-group" style="margin-bottom:10px">
              <label>Efficiency Alert Message</label>
              <textarea id="f-perf-alert" placeholder="Describe overall performance issues..."></textarea>
            </div>
            <button class="add-row-btn" id="btn-add-perf2">+ Add Metric</button>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Scope of Work</h3>
            <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-scope">+ Add</button>
          </div>
          <div class="form-section-body">
            <div class="dyn-list" id="scope-list"></div>
            <button class="add-row-btn" id="btn-add-scope2">+ Add Phase</button>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Materials</h3>
            <div style="display:flex;gap:6px">
              <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-from-catalog-mat">Catalog</button>
              <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-mat">+ Add</button>
            </div>
          </div>
          <div class="form-section-body">
            <div class="form-grid" style="margin-bottom:14px">
              <div class="form-group"><label>Unit Description</label><input id="f-mat-unit" placeholder="BAC CXV-134P"/></div>
              <div class="form-group"><label>Fill Pack Size</label><input id="f-mat-size" placeholder="L-105 x 52 Deep"/></div>
              <div class="form-group"><label>Lead Time</label><input id="f-mat-lead" placeholder="3 Weeks - Order Immediately"/></div>
            </div>
            <div class="dyn-list" id="mat-list"></div>
            <button class="add-row-btn" id="btn-add-mat2">+ Add Material</button>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Additional Costs</h3>
            <div style="display:flex;gap:6px">
              <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-from-catalog-cost">Catalog</button>
              <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-cost">+ Add</button>
            </div>
          </div>
          <div class="form-section-body">
            <div class="dyn-list" id="costs-list"></div>
            <button class="add-row-btn" id="btn-add-cost2">+ Add Cost</button>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Totals</h3>
            <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-margin-toggle">Margin Calc</button>
          </div>
          <div class="form-section-body">
            <!-- Margin Calculator -->
            <div id="margin-calc" class="margin-calc" data-mode="markup">
              <div style="font-size:12px;font-weight:600;color:var(--teal);text-transform:uppercase;letter-spacing:.05em;margin-bottom:10px">Profit Margin Calculator</div>
              <div class="margin-calc-grid">
                <div class="form-group"><label>Your Cost</label><input id="mc-cost" placeholder="$5,000.00"/></div>
                <div class="form-group"><label>Markup %</label><input id="mc-markup" placeholder="30"/></div>
                <div class="form-group"><label>-OR- Target Margin %</label><input id="mc-margin" placeholder="23.1"/></div>
              </div>
              <div class="margin-result"><span class="mr-label">Sell Price</span><span class="mr-value" id="mc-sell">--</span></div>
              <div class="margin-result"><span class="mr-label">Profit</span><span class="mr-value" id="mc-profit">--</span></div>
              <div class="margin-result"><span class="mr-label">Effective Margin</span><span class="mr-value" id="mc-eff-margin">--</span></div>
              <div class="margin-result"><span class="mr-label">Effective Markup</span><span class="mr-value" id="mc-eff-markup">--</span></div>
              <div style="margin-top:10px">
                <button class="btn btn-sm btn-primary" id="btn-apply-margin">Apply to Grand Total</button>
              </div>
            </div>

            <div class="form-grid" style="margin-bottom:16px">
              <div class="form-group"><label>Materials Subtotal</label><input id="f-tot-mat" placeholder="$0.00"/></div>
              <div class="form-group"><label>Labor Subtotal</label><input id="f-tot-labor" placeholder="$0.00"/></div>
              <div class="form-group"><label>Additional Costs</label><input id="f-tot-add" placeholder="$0.00"/></div>
              <div class="form-group"><label>Contingency</label><input id="f-tot-cont" placeholder="$0.00"/></div>
              <div class="form-group"><label>Grand Total</label><input id="f-tot-grand" placeholder="$0.00"/></div>
              <div class="form-group"><label>Deposit (50%)</label><input id="f-tot-deposit" placeholder="$0.00"/></div>
            </div>
            <div class="totals-panel">
              <div class="totals-row"><span class="lbl">Materials</span><span class="val" id="tp-mat">-</span></div>
              <div class="totals-row"><span class="lbl">Labor</span><span class="val" id="tp-labor">-</span></div>
              <div class="totals-row"><span class="lbl">Additional</span><span class="val" id="tp-add">-</span></div>
              <div class="totals-row"><span class="lbl">Contingency</span><span class="val" id="tp-cont">-</span></div>
              <div class="totals-row divider grand"><span class="lbl">TOTAL</span><span class="val" id="tp-grand">-</span></div>
              <div class="totals-row deposit"><span class="lbl">Deposit (50%)</span><span class="val" id="tp-deposit">-</span></div>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Notes &amp; Recommendations</h3>
            <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-note">+ Add</button>
          </div>
          <div class="form-section-body">
            <div class="dyn-list" id="notes-list"></div>
            <button class="add-row-btn" id="btn-add-note2">+ Add Note</button>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header">
            <h3>Site Photos</h3>
            <span id="photo-count-label" style="font-size:11px;color:rgba(255,255,255,.5)">0 photos</span>
          </div>
          <div class="form-section-body">
            <div class="photo-grid" id="photo-grid"></div>
            <div class="photo-upload-zone">
              <input type="file" accept="image/*" multiple id="photo-file-input"/>
              <span class="upload-icon">&#128247;</span>
              <p><strong>Tap to add photos</strong></p>
              <p class="hint">JPG, PNG - multiple OK - included in PDF</p>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header"><h3>Warranty &amp; Terms</h3></div>
          <div class="form-section-body">
            <div class="form-group">
              <textarea id="f-warranty" rows="3"></textarea>
            </div>
          </div>
        </div>

        <div class="form-section">
          <div class="form-section-header"><h3>Send Estimate</h3></div>
          <div class="form-section-body">
            <div class="form-grid">
              <div class="form-group"><label>Recipient Email</label><input id="f-send-email" type="email" placeholder="client@company.com"/></div>
              <div class="form-group"><label>CC (optional)</label><input id="f-cc-email" type="email" placeholder="tim@rmctr.com"/></div>
            </div>
            <div style="display:flex;gap:10px;margin-top:14px;flex-wrap:wrap">
              <button class="btn btn-teal" id="btn-email2">&#128139; Email PDF to Client</button>
              <button class="btn btn-primary" id="btn-download2">&#8659; Download PDF</button>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- ═══ CUSTOMERS ═══ -->
    <div id="page-customers" class="page">
      <div class="form-section">
        <div class="form-section-header">
          <h3>Customer Database</h3>
          <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-customer">+ Add Customer</button>
        </div>
        <div class="form-section-body">
          <p style="font-size:12px;color:var(--gray);margin-bottom:14px">Customers are automatically saved when you create estimates. You can also add them manually.</p>
          <div id="customers-list"></div>
        </div>
      </div>
    </div>

    <!-- ═══ CATALOG ═══ -->
    <div id="page-catalog" class="page">
      <div class="form-section">
        <div class="form-section-header">
          <h3>Parts &amp; Materials Catalog</h3>
          <button class="btn btn-sm" style="background:rgba(255,255,255,.15);color:#fff;border:none;min-height:32px" id="btn-add-catalog">+ Add Item</button>
        </div>
        <div class="form-section-body">
          <p style="font-size:12px;color:var(--gray);margin-bottom:14px">Save commonly used materials and parts for quick access when building estimates.</p>
          <div id="catalog-list"></div>
        </div>
      </div>
    </div>

    <!-- ═══ SETTINGS ═══ -->
    <div id="page-settings" class="page">
      <div class="form-section">
        <div class="form-section-header"><h3>Company Information</h3></div>
        <div class="form-section-body">
          <div class="form-grid">
            <div class="form-group"><label>Short Name</label><input id="s-name"/></div>
            <div class="form-group form-full"><label>Full Company Name</label><input id="s-fullname"/></div>
            <div class="form-group form-full"><label>Address</label><input id="s-address"/></div>
            <div class="form-group"><label>Phone</label><input id="s-phone"/></div>
            <div class="form-group"><label>Email</label><input id="s-email"/></div>
            <div class="form-group"><label>Contact Name</label><input id="s-contact"/></div>
          </div>
          <div style="margin-top:16px">
            <button class="btn btn-primary" id="btn-save-settings">Save Settings</button>
          </div>
        </div>
      </div>
    </div>

    <!-- ═══ HELP & INFO ═══ -->
    <div id="page-help" class="page">

      <div class="form-section">
        <div class="form-section-header"><h3>About RMCTR Estimator</h3></div>
        <div class="form-section-body" style="line-height:1.7;font-size:14px">
          <p>A professional estimate generator for cooling tower inspection and repair field technicians. This app runs entirely in your browser &mdash; no servers, no accounts, no subscriptions. Your data stays on your device.</p>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-header"><h3>Getting Started</h3></div>
        <div class="form-section-body help-list">
          <div class="help-item">
            <div class="help-icon">&#128204;</div>
            <div>
              <b>Install on Your Phone</b>
              <p>On <b>iPhone</b>: Open in Safari, tap the <b>Share</b> button (box with arrow), then <b>"Add to Home Screen"</b>.<br/>
              On <b>Android</b>: Open in Chrome, tap the <b>&#8942; menu</b>, then <b>"Install App"</b> or <b>"Add to Home Screen"</b>.<br/>
              Once installed, it works offline like a native app.</p>
            </div>
          </div>
          <div class="help-item">
            <div class="help-icon">&#128221;</div>
            <div>
              <b>Create an Estimate</b>
              <p>Tap <b>New Estimate</b> in the sidebar. Choose a blank form or start from a template (Fill Media Replacement, Gearbox Overhaul, Fan Deck Repair, Annual Inspection, Basin Repair). Fill in job info, findings, scope of work, materials, and costs. Hit <b>Save Draft</b> at any time.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-header"><h3>Features</h3></div>
        <div class="form-section-body help-list">

          <div class="help-item">
            <div class="help-icon">&#128196;</div>
            <div>
              <b>PDF Generation &amp; Themes</b>
              <p>Generate professional PDFs from any estimate. Choose from 3 themes: <b>Standard</b> (full branded layout), <b>Minimal</b> (clean black &amp; white), or <b>Executive Summary</b> (condensed 1-page overview). Preview before downloading.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128231;</div>
            <div>
              <b>Email &amp; Share</b>
              <p>Use the <b>Email</b> button to open a pre-filled email with the PDF attached. Use <b>Share</b> to generate a compressed link anyone can open (no account needed). Use <b>QR</b> to create a scannable code for the estimate.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128203;</div>
            <div>
              <b>Estimate Templates</b>
              <p>5 built-in templates pre-fill findings, scope, materials, and notes for common jobs. You can also save any estimate as a custom template via <b>Save as Template</b> in the editor toolbar.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128260;</div>
            <div>
              <b>Estimate Versioning</b>
              <p>Need to revise a quote? Hit <b>New Version</b> to archive the current version and create a fresh revision. Switch between versions using the dropdown. The dashboard shows the latest version with a version badge.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128101;</div>
            <div>
              <b>Customer Database</b>
              <p>Customers are auto-saved from estimates. The <b>Customers</b> page lets you add, edit, and delete entries. When creating a new estimate, start typing a customer name and it auto-fills their info from the database.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128230;</div>
            <div>
              <b>Parts Catalog</b>
              <p>Save frequently-used materials and costs in the <b>Parts Catalog</b>. When adding line items to an estimate, use the <b>From Catalog</b> button to quickly insert pre-filled rows instead of typing them each time.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128200;</div>
            <div>
              <b>Dashboard &amp; Charts</b>
              <p>The Dashboard shows all your estimates with status badges, stat cards (total jobs, revenue, drafts), a bar chart of revenue by month, and a donut chart of jobs by status. Search and filter from the top bar.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128178;</div>
            <div>
              <b>Profit Margin Calculator</b>
              <p>In the Totals section of any estimate, expand the <b>Margin Calculator</b>. Enter your cost and either a markup % or target margin % &mdash; it calculates the sell price and profit. Hit <b>Apply</b> to push it into the Grand Total.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128722;</div>
            <div>
              <b>Shopify Export</b>
              <p>Click the <b>Shopify</b> button in the editor toolbar to format your estimate for Shopify. It shows customer info, line items, notes, and totals &mdash; each with a <b>Copy</b> button. Paste directly into Shopify Admin &rarr; Orders &rarr; Drafts &rarr; Create order. You can also download a <b>CSV</b> of line items.</p>
              <p style="color:var(--gray);font-size:12px"><em>Note: This is a manual copy-paste bridge. The app does not connect to Shopify's API directly &mdash; your data never leaves your device.</em></p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128190;</div>
            <div>
              <b>Export &amp; Import</b>
              <p>Back up everything with <b>Export All</b> on the Dashboard (saves a .json file). Import it on any device with <b>Import</b>. You can also export individual estimates from their job card.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#127769;</div>
            <div>
              <b>Dark Mode</b>
              <p>Toggle dark/light mode with the moon icon at the bottom of the sidebar. Your preference is saved automatically.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#9000;</div>
            <div>
              <b>Keyboard Shortcuts</b>
              <p>Press <b>Shift + ?</b> anywhere to see all shortcuts. Highlights: <b>Ctrl+S</b> save, <b>Ctrl+P</b> preview PDF, <b>Ctrl+D</b> download, <b>Ctrl+N</b> new estimate, <b>Ctrl+Shift+F/M/S</b> add rows, <b>Esc</b> close modals.</p>
            </div>
          </div>

          <div class="help-item">
            <div class="help-icon">&#128424;</div>
            <div>
              <b>Print</b>
              <p>Hit the <b>Print</b> button in the editor toolbar for a clean, print-optimized version of your estimate. Hides all app UI and formats for paper.</p>
            </div>
          </div>

        </div>
      </div>

      <div class="form-section">
        <div class="form-section-header"><h3>Data &amp; Privacy</h3></div>
        <div class="form-section-body help-list">
          <div class="help-item">
            <div class="help-icon">&#128274;</div>
            <div>
              <b>100% Local Storage</b>
              <p>All data (estimates, customers, catalog, settings, templates) is stored in your browser's localStorage. Nothing is sent to any server. If you clear your browser data, it will be erased &mdash; use <b>Export All</b> to back up regularly.</p>
            </div>
          </div>
          <div class="help-item">
            <div class="help-icon">&#128241;</div>
            <div>
              <b>Works Offline</b>
              <p>Once loaded, the app is cached by the service worker and works without internet. New updates are automatically downloaded when you're back online.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-header"><h3>Tips</h3></div>
        <div class="form-section-body" style="line-height:1.7;font-size:14px">
          <ul style="margin:0;padding-left:20px">
            <li>Use <b>Duplicate</b> on the Dashboard to clone an estimate and adjust it for a similar job.</li>
            <li>Save your most common job type as a template &mdash; it saves significant time on repeat work.</li>
            <li>The Margin Calculator is great for quick what-if pricing before sending a quote.</li>
            <li>Share links include all estimate data except photos (to keep URLs small). Use JSON export for full backups with photos.</li>
            <li>Export your data regularly as a backup &mdash; browser storage can be cleared accidentally.</li>
          </ul>
        </div>
      </div>

    </div>

  </div>
</div>
</div>

<!-- ═══ PDF Preview Modal ═══ -->
<div id="pdf-modal">
  <div id="pdf-modal-inner">
    <div id="pdf-modal-header">
      <h3>PDF Preview</h3>
      <div style="display:flex;gap:10px">
        <button class="btn btn-primary btn-sm" id="btn-modal-download">&#8659; Download</button>
        <button class="btn btn-ghost btn-sm" id="btn-modal-close">&#10005; Close</button>
      </div>
    </div>
    <div id="pdf-modal-body"></div>
  </div>
</div>

<!-- ═══ Template Picker Modal ═══ -->
<div id="template-modal" class="modal-overlay">
  <div class="modal-box" style="max-width:700px">
    <div class="modal-header">
      <h3>New Estimate</h3>
      <button class="btn btn-ghost btn-sm" id="btn-tpl-close">&#10005; Close</button>
    </div>
    <div class="modal-body" id="template-modal-body"></div>
  </div>
</div>

<!-- ═══ Catalog Picker Modal ═══ -->
<div id="catalog-modal" class="modal-overlay">
  <div class="modal-box">
    <div class="modal-header">
      <h3>Pick from Catalog</h3>
      <button class="btn btn-ghost btn-sm" id="btn-cat-close">&#10005; Close</button>
    </div>
    <div class="modal-body">
      <input type="text" class="catalog-search" id="catalog-picker-search" placeholder="Search catalog..."/>
      <div id="catalog-picker-results"></div>
    </div>
  </div>
</div>

<!-- ═══ QR Code Modal ═══ -->
<div id="qr-modal" class="modal-overlay">
  <div class="modal-box" style="max-width:400px">
    <div class="modal-header">
      <h3>Share QR Code</h3>
      <button class="btn btn-ghost btn-sm" id="btn-qr-close">&#10005; Close</button>
    </div>
    <div class="modal-body" style="text-align:center;padding:30px">
      <div id="qr-container"></div>
      <p style="font-size:12px;color:var(--gray);margin-top:14px">Scan to open this estimate (photos excluded)</p>
    </div>
  </div>
</div>

<!-- ═══ Shopify Draft Order Modal ═══ -->
<div id="shopify-modal" class="modal-overlay">
  <div class="modal-box" style="max-width:680px">
    <div class="modal-header">
      <h3>&#128722; Shopify Draft Order</h3>
      <button class="btn btn-ghost btn-sm" id="btn-shopify-close">&#10005; Close</button>
    </div>
    <div class="modal-body" id="shopify-modal-body" style="padding:20px;font-size:13px">
      <!-- Populated by JS -->
    </div>
  </div>
</div>

<!-- ═══ Keyboard Shortcuts Modal ═══ -->
<div id="shortcuts-modal" class="modal-overlay">
  <div class="modal-box" style="max-width:500px">
    <div class="modal-header">
      <h3>Keyboard Shortcuts</h3>
      <button class="btn btn-ghost btn-sm" id="btn-sc-close">&#10005; Close</button>
    </div>
    <div class="modal-body">
      <div class="shortcut-list">
        <div class="shortcut-row"><div class="sc-keys"><kbd>Ctrl</kbd><kbd>S</kbd></div><span class="sc-action">Save draft</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Ctrl</kbd><kbd>P</kbd></div><span class="sc-action">Preview PDF</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Ctrl</kbd><kbd>D</kbd></div><span class="sc-action">Download PDF</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Ctrl</kbd><kbd>N</kbd></div><span class="sc-action">New estimate</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>F</kbd></div><span class="sc-action">Add finding row</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>M</kbd></div><span class="sc-action">Add material row</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Ctrl</kbd><kbd>Shift</kbd><kbd>S</kbd></div><span class="sc-action">Add scope row</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Esc</kbd></div><span class="sc-action">Close modals</span></div>
        <div class="shortcut-row"><div class="sc-keys"><kbd>Shift</kbd><kbd>?</kbd></div><span class="sc-action">Show this help</span></div>
      </div>
    </div>
  </div>
</div>

<div id="overlay"></div>
<div id="toast"></div>

<!-- ═══ Install Banner (mobile) ═══ -->
<div id="install-banner" style="display:none;position:fixed;bottom:0;left:0;right:0;z-index:9998;background:var(--teal);color:var(--white);padding:18px 20px;box-shadow:0 -4px 24px rgba(0,0,0,.3);border-top:3px solid var(--amber)">
  <div style="display:flex;align-items:center;gap:14px;max-width:600px;margin:0 auto">
    <img src="logo/rmctr-logo.png" alt="" style="width:48px;height:48px;border-radius:10px;background:#fff;padding:3px;flex-shrink:0"/>
    <div style="flex:1;min-width:0">
      <div style="font-weight:600;font-size:14px;margin-bottom:3px">Install RMCTR Estimator</div>
      <div id="install-instructions" style="font-size:12px;color:rgba(255,255,255,.7);line-height:1.4"></div>
    </div>
    <div style="display:flex;flex-direction:column;gap:6px;flex-shrink:0">
      <button id="install-btn" class="btn btn-sm btn-primary" style="min-width:80px;justify-content:center">Install</button>
      <button id="install-dismiss" style="background:none;border:none;color:rgba(255,255,255,.5);font-size:11px;cursor:pointer;font-family:var(--font-b);padding:4px">Not now</button>
    </div>
  </div>
</div>

<script src="js/data.js"></script>
<script src="js/form.js"></script>
<script src="js/dashboard.js"></script>
<script src="js/pdf.js"></script>
<script src="js/templates.js"></script>
<script src="js/margin.js"></script>
<script src="js/share.js"></script>
<script src="js/shortcuts.js"></script>
<script src="js/app.js"></script>
</body>
</html>
